<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisor Dashboard - Live Demo (ENGSE206)</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for professional typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', 'Sarabun', sans-serif;
            background-color: #f0f2f5; /* Slightly updated background color */
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-screen-xl mx-auto">
        <!-- Header Section -->
        <header class="bg-white p-4 rounded-xl shadow-md mb-6 fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-blue-800">Supervisor Dashboard</h1>
                    <p class="text-sm text-gray-500">Real-time Agent Monitoring Demo for ENGSE206</p>
                </div>
                <div id="connection-status" class="mt-2 md:mt-0 flex items-center gap-2 text-sm font-semibold bg-green-100 text-green-800 px-3 py-1 rounded-full">
                    <div class="w-2.5 h-2.5 bg-green-500 rounded-full"></div>
                    <span>Connected</span>
                </div>
            </div>
        </header>

        <!-- Team Statistics (Horizontal Layout) -->
        <div class="bg-white p-4 rounded-xl shadow-md mb-6 fade-in" style="animation-delay: 0.1s;">
             <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold text-gray-700">Team Statistics</h2>
                <div class="text-xs text-gray-500">Last Updated: <span id="last-updated">...</span></div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div id="stat-available" class="flex items-center p-3 rounded-lg bg-green-100 border-l-4 border-green-500">
                    <div class="text-3xl font-bold text-green-600">0</div><div class="ml-2 text-sm font-semibold text-gray-700">Available</div>
                </div>
                <div id="stat-busy" class="flex items-center p-3 rounded-lg bg-orange-100 border-l-4 border-orange-500">
                    <div class="text-3xl font-bold text-orange-600">0</div><div class="ml-2 text-sm font-semibold text-gray-700">Busy</div>
                </div>
                <div id="stat-break" class="flex items-center p-3 rounded-lg bg-blue-100 border-l-4 border-blue-500">
                     <div class="text-3xl font-bold text-blue-600">0</div><div class="ml-2 text-sm font-semibold text-gray-700">Break</div>
                </div>
                <div id="stat-offline" class="flex items-center p-3 rounded-lg bg-gray-200 border-l-4 border-gray-500">
                     <div class="text-3xl font-bold text-gray-600">0</div><div class="ml-2 text-sm font-semibold text-gray-700">Offline</div>
                </div>
            </div>
        </div>


        <!-- Main Content Area -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Message Panel -->
            <div class="lg:col-span-1 fade-in" style="animation-delay: 0.2s;">
                <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                    <h2 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4">Send Message</h2>
                    <form id="message-form" class="flex flex-col gap-4 h-full">
                        <select id="agent-select" class="w-full p-2 border rounded-md bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:outline-none"></select>
                        <textarea id="message-text" placeholder="Type your message..." rows="6" class="w-full p-2 border rounded-md bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none flex-grow"></textarea>
                        <button type="submit" class="self-end bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Send</button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Agent Status Grid -->
            <div class="lg:col-span-2 bg-white p-5 rounded-xl shadow-lg fade-in" style="animation-delay: 0.3s;">
                <h2 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4">Agent Real-time Status</h2>
                <div id="agent-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                    <!-- Agent cards will be dynamically inserted here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA & CONFIGURATION ---
            const initialAgents = [
                { id: 'AG-001', name: 'ธนพล ใจดี', status: 'Available', isOnline: true, statusSince: new Date(Date.now() - 5 * 60000) },
                { id: 'AG-002', name: 'สมศรี มีสุข', status: 'Busy', isOnline: true, statusSince: new Date(Date.now() - 12 * 60000) },
                { id: 'AG-003', name: 'มานะ อดทน', status: 'Break', isOnline: true, statusSince: new Date(Date.now() - 2 * 60000) },
                { id: 'AG-004', name: 'ปรีดา การุณ', status: 'Offline', isOnline: false, statusSince: new Date(Date.now() - 60 * 60000) },
                { id: 'AG-005', name: 'กานดา รักงาน', status: 'Available', isOnline: true, statusSince: new Date(Date.now() - 25 * 60000) },
                { id: 'AG-006', name: 'วิชัย พากเพียร', status: 'Busy', isOnline: true, statusSince: new Date(Date.now() - 1 * 60000) }
            ];

            const statuses = ['Available', 'Busy', 'Break', 'Offline'];
            const statusConfig = {
                Available: { color: 'green-500', icon: '✅', text: 'text-green-800', bg: 'bg-green-100', border: 'border-green-500' },
                Busy: { color: 'orange-500', icon: '🔄', text: 'text-orange-800', bg: 'bg-orange-100', border: 'border-orange-500' },
                Break: { color: 'blue-500', icon: '☕', text: 'text-blue-800', bg: 'bg-blue-100', border: 'border-blue-500' },
                Offline: { color: 'gray-500', icon: '🔴', text: 'text-gray-800', bg: 'bg-gray-200', border: 'border-gray-500' }
            };

            // --- ELEMENT SELECTORS ---
            const agentGrid = document.getElementById('agent-grid');
            const agentSelect = document.getElementById('agent-select');
            const messageForm = document.getElementById('message-form');

            // --- HELPER FUNCTIONS ---
            const getStatusDuration = (startTime) => {
                if (!startTime) return 'N/A';
                const diffMs = new Date() - new Date(startTime);
                const diffMins = Math.round(diffMs / 60000);
                if (diffMins < 1) return '< 1 min';
                if (diffMins < 60) return `${diffMins} mins`;
                return `${Math.floor(diffMins / 60)}h ${diffMins % 60}m`;
            };
            
            // --- CORE RENDER FUNCTION ---
            function renderUI() {
                agentGrid.innerHTML = '';
                agentSelect.innerHTML = '<option value="">-- Send to All (Broadcast) --</option>';
                const stats = { Available: 0, Busy: 0, Break: 0, Offline: 0 };

                initialAgents.forEach(agent => {
                    stats[agent.status]++;
                    const config = statusConfig[agent.status];
                    
                    const card = document.createElement('div');
                    card.className = `p-3 rounded-lg shadow-md ${config.bg} border-l-4 ${config.border} transition-transform hover:scale-105`;
                    
                    const onlineIndicatorHTML = agent.isOnline ? `<div class="absolute top-2 right-2 w-3 h-3 rounded-full bg-green-500 animate-pulse" style="box-shadow: 0 0 0 2px white;"></div>` : '';

                    card.innerHTML = `
                        <div class="relative flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">${config.icon}</span>
                                <div>
                                    <p class="font-bold text-gray-800 text-sm leading-tight">${agent.name}</p>
                                    <p class="text-xs text-gray-500">${agent.id}</p>
                                </div>
                            </div>
                            <div class="relative">
                                <button data-id="${agent.id}" class="action-menu-btn p-1 rounded-full hover:bg-gray-300/50">
                                    <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path></svg>
                                </button>
                                <div id="menu-${agent.id}" class="action-menu hidden absolute right-0 mt-2 w-36 bg-white rounded-md shadow-xl z-10 border">
                                    <div class="py-1">
                                        <p class="px-4 pt-2 pb-1 text-xs text-gray-400">Change Status</p>
                                        ${statuses.map(s => s !== agent.status ? `<a href="#" data-id="${agent.id}" data-status="${s}" class="status-option-btn block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Set ${s}</a>` : '').join('')}
                                    </div>
                                </div>
                            </div>
                            ${onlineIndicatorHTML}
                        </div>
                        <div class="mt-2 text-center text-xs ${config.text} font-semibold py-1 rounded">
                             ${agent.status} for ${getStatusDuration(agent.statusSince)}
                        </div>
                    `;
                    agentGrid.appendChild(card);

                    if (agent.isOnline && agent.status !== 'Offline') {
                        const option = document.createElement('option');
                        option.value = agent.id;
                        option.textContent = `${agent.name} (${agent.id})`;
                        agentSelect.appendChild(option);
                    }
                });

                // Update Team Statistics
                document.querySelector('#stat-available div:first-child').textContent = stats.Available;
                document.querySelector('#stat-busy div:first-child').textContent = stats.Busy;
                document.querySelector('#stat-break div:first-child').textContent = stats.Break;
                document.querySelector('#stat-offline div:first-child').textContent = stats.Offline;
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString('th-TH');
            }

            // --- EVENT LISTENERS ---
            document.body.addEventListener('click', (e) => {
                const actionBtn = e.target.closest('.action-menu-btn');
                
                // Close all menus that are not the target
                document.querySelectorAll('.action-menu').forEach(menu => {
                    if (!actionBtn || menu.id !== `menu-${actionBtn.dataset.id}`) {
                        menu.classList.add('hidden');
                    }
                });

                if (actionBtn) {
                    const agentId = actionBtn.dataset.id;
                    document.getElementById(`menu-${agentId}`).classList.toggle('hidden');
                } else if (e.target.closest('.status-option-btn')) {
                    e.preventDefault();
                    const statusOption = e.target.closest('.status-option-btn');
                    const agentId = statusOption.dataset.id;
                    const newStatus = statusOption.dataset.status;
                    const agent = initialAgents.find(a => a.id === agentId);
                    if (agent) {
                        agent.status = newStatus;
                        agent.statusSince = new Date();
                        agent.isOnline = newStatus !== 'Offline';
                        console.log(`SIMULATE: Agent ${agent.name} status changed to ${newStatus}`);
                        renderUI();
                    }
                }
            });

            messageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const agentId = agentSelect.value;
                const message = document.getElementById('message-text').value;
                if (!message.trim()) { alert('Please enter a message.'); return; }
                const target = agentId ? `Agent ${agentId}` : 'everyone in the team';
                alert(`SIMULATE: Sending message to ${target}:\n\n"${message}"`);
                document.getElementById('message-text').value = '';
                agentSelect.value = '';
            });

            // --- INITIALIZATION ---
            renderUI();
            setInterval(renderUI, 30000); // Auto-refresh for time duration
        });
    </script>
</body>
</html>

