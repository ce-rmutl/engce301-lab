# âš™ï¸ à¸„à¸¹à¹ˆà¸¡à¸·à¸­ PM2 Process Manager
## à¸ªà¸³à¸«à¸£à¸±à¸š ENGCE301 Software Design and Development

**à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸¨à¸¶à¸à¸©à¸²:** 30-45 à¸™à¸²à¸—à¸µ | **à¸£à¸°à¸”à¸±à¸š:** à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™-à¸à¸¥à¸²à¸‡

---

## ğŸ“‹ à¸ªà¸²à¸£à¸šà¸±à¸

1. [PM2 à¸„à¸·à¸­à¸­à¸°à¹„à¸£?](#1-pm2-à¸„à¸·à¸­à¸­à¸°à¹„à¸£)
2. [à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ PM2?](#2-à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰-pm2)
3. [à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ PM2](#3-à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡-pm2)
4. [à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸à¸·à¹‰à¸™à¸à¸²à¸™](#4-à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸à¸·à¹‰à¸™à¸à¸²à¸™)
5. [à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Process](#5-à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£-process)
6. [Ecosystem File](#6-ecosystem-file)
7. [Monitoring à¹à¸¥à¸° Logs](#7-monitoring-à¹à¸¥à¸°-logs)
8. [Cluster Mode](#8-cluster-mode)
9. [à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š PM2](#9-à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š-pm2)
10. [à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢](#10-à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢)
11. [Best Practices](#11-best-practices)

---

## 1. PM2 à¸„à¸·à¸­à¸­à¸°à¹„à¸£?

### 1.1 à¸„à¸³à¸ˆà¸³à¸à¸±à¸”à¸„à¸§à¸²à¸¡

**PM2 (Process Manager 2)** à¸„à¸·à¸­ Production-grade Process Manager à¸ªà¸³à¸«à¸£à¸±à¸š Node.js à¸—à¸µà¹ˆà¸Šà¹ˆà¸§à¸¢à¸ˆà¸±à¸”à¸à¸²à¸£ application à¹ƒà¸«à¹‰à¸—à¸³à¸‡à¸²à¸™à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PM2 Overview                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚   à¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰ PM2:                         à¸«à¸¥à¸±à¸‡à¹ƒà¸Šà¹‰ PM2:                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                                                   â”‚
â”‚   $ node server.js                  $ pm2 start server.js         â”‚
â”‚   Server running...                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   ^C                                â”‚         PM2             â”‚   â”‚
â”‚   (à¸«à¸¢à¸¸à¸”à¸—à¸³à¸‡à¸²à¸™)                        â”‚   Process Manager       â”‚   â”‚
â”‚                                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   âŒ à¸›à¸´à¸” terminal = App à¸«à¸¢à¸¸à¸”          â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚   âŒ Error = App crash              â”‚  â”‚App 1â”‚  â”‚App 2â”‚  ...  â”‚   â”‚
â”‚   âŒ Restart manual                 â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚   âŒ à¹„à¸¡à¹ˆà¸¡à¸µ logs                       â”‚                         â”‚   â”‚
â”‚                                     â”‚  âœ… Auto Restart        â”‚   â”‚
â”‚                                     â”‚  âœ… Background Run      â”‚   â”‚
â”‚                                     â”‚  âœ… Log Management      â”‚   â”‚
â”‚                                     â”‚  âœ… Monitoring          â”‚   â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸š Week 6 Lab
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Week 6 N-Tier Architecture                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Browser  â”€â”€â”€â–º Nginx (HTTPS) â”€â”€â”€â–º Node.js (PM2) â”€â”€â”€â–º PostgreSQL â”‚
â”‚                    â”‚                    â”‚                        â”‚
â”‚                    â–¼                    â–¼                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚          â”‚ HTTPS_SSL_GUIDE â”‚  â”‚   PM2_GUIDE     â”‚                â”‚
â”‚          â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚          â”‚ â€¢ SSL/TLS       â”‚  â”‚ â€¢ Process Mgmt  â”‚                â”‚
â”‚          â”‚ â€¢ Self-signed   â”‚  â”‚ â€¢ Auto Restart  â”‚                â”‚
â”‚          â”‚ â€¢ Nginx config  â”‚  â”‚ â€¢ Cluster Mode  â”‚                â”‚
â”‚          â”‚ â€¢ Testing       â”‚  â”‚ â€¢ Monitoring    â”‚                â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 à¸„à¸§à¸²à¸¡à¸ªà¸²à¸¡à¸²à¸£à¸–à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡ PM2

| Feature | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|---------|-----------|
| **Process Management** | Start, Stop, Restart, Delete processes |
| **Auto Restart** | Restart à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­ crash |
| **Cluster Mode** | Load balance à¸”à¹‰à¸§à¸¢à¸«à¸¥à¸²à¸¢ instances |
| **Log Management** | à¹€à¸à¹‡à¸šà¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£ logs |
| **Monitoring** | à¸”à¸¹ CPU, Memory, Status real-time |
| **Startup Script** | à¸£à¸±à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­ boot à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ |
| **Zero Downtime Reload** | Reload à¹„à¸¡à¹ˆà¸¡à¸µ downtime |
| **Environment Management** | à¸ˆà¸±à¸”à¸à¸²à¸£ env variables |

---

## 2. à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ PM2?

### 2.1 à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸§à¸´à¸˜à¸µà¸à¸²à¸£à¸£à¸±à¸™ Node.js

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   à¸§à¸´à¸˜à¸µà¸à¸²à¸£à¸£à¸±à¸™ Node.js Application                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   1. node server.js (Development)                                  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚   âŒ Foreground process                                            â”‚
â”‚   âŒ à¸«à¸¢à¸¸à¸”à¹€à¸¡à¸·à¹ˆà¸­à¸›à¸´à¸” terminal                                             â”‚
â”‚   âŒ à¹„à¸¡à¹ˆ restart à¹€à¸¡à¸·à¹ˆà¸­ crash                                          â”‚
â”‚   âŒ à¹„à¸¡à¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸š production                                          â”‚
â”‚                                                                    â”‚
â”‚   2. node server.js & (Background)                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚   âœ… Background process                                            â”‚
â”‚   âŒ à¸«à¸¢à¸¸à¸”à¹€à¸¡à¸·à¹ˆà¸­ logout                                                 â”‚
â”‚   âŒ à¹„à¸¡à¹ˆ restart à¹€à¸¡à¸·à¹ˆà¸­ crash                                          â”‚
â”‚   âŒ Log à¸«à¸²à¸¢à¹„à¸›                                                     â”‚
â”‚                                                                    â”‚
â”‚   3. nohup node server.js & (Persistent)                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚   âœ… à¹„à¸¡à¹ˆà¸«à¸¢à¸¸à¸”à¹€à¸¡à¸·à¹ˆà¸­ logout                                               â”‚
â”‚   âŒ à¹„à¸¡à¹ˆ restart à¹€à¸¡à¸·à¹ˆà¸­ crash                                          â”‚
â”‚   âŒ à¸ˆà¸±à¸”à¸à¸²à¸£à¸¢à¸²à¸                                                      â”‚
â”‚   âŒ à¹„à¸¡à¹ˆà¸¡à¸µ monitoring                                                â”‚
â”‚                                                                    â”‚
â”‚   4. PM2 (Production Ready) â­                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   âœ… Background + Persistent                                       â”‚
â”‚   âœ… Auto restart à¹€à¸¡à¸·à¹ˆà¸­ crash                                        â”‚
â”‚   âœ… Log management                                                â”‚
â”‚   âœ… Monitoring                                                    â”‚
â”‚   âœ… Cluster mode                                                  â”‚
â”‚   âœ… Zero downtime reload                                          â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 PM2 vs Alternatives

| Feature | PM2 | Forever | Nodemon | systemd |
|---------|-----|---------|---------|---------|
| Auto Restart | âœ… | âœ… | âœ… | âœ… |
| Cluster Mode | âœ… | âŒ | âŒ | âŒ |
| Log Management | âœ… | âš ï¸ | âŒ | âœ… |
| Monitoring | âœ… | âŒ | âŒ | âš ï¸ |
| Zero Downtime | âœ… | âŒ | âŒ | âš ï¸ |
| Easy to Use | âœ… | âœ… | âœ… | âŒ |
| Node.js Native | âœ… | âœ… | âœ… | âŒ |

---

## 3. à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ PM2

### 3.1 à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¸”à¹‰à¸§à¸¢ npm

```bash
# à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ PM2 globally
sudo npm install -g pm2

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š version
pm2 --version
# 5.3.0

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š path
which pm2
# /usr/bin/pm2 à¸«à¸£à¸·à¸­ ~/.npm-global/bin/pm2
```

### 3.2 à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¸”à¹‰à¸§à¸¢ yarn

```bash
# à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¸”à¹‰à¸§à¸¢ yarn
sudo yarn global add pm2

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š
pm2 --version
```

### 3.3 Update PM2

```bash
# Update PM2
sudo npm install -g pm2@latest

# Update in-memory PM2
pm2 update
```

---

## 4. à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸à¸·à¹‰à¸™à¸à¸²à¸™

### 4.1 Start Application

```bash
# à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 1: Start à¸”à¹‰à¸§à¸¢à¸Šà¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œ
pm2 start server.js

# à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 2: Start à¸à¸£à¹‰à¸­à¸¡à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­
pm2 start server.js --name "taskboard-api"

# à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 3: Start à¸à¸£à¹‰à¸­à¸¡ options
pm2 start server.js --name "taskboard-api" --watch --env production

# à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 4: Start à¸”à¹‰à¸§à¸¢ npm script
pm2 start npm --name "taskboard-api" -- start

# à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 5: Start à¸”à¹‰à¸§à¸¢ ecosystem file
pm2 start ecosystem.config.js
```

### 4.2 Quick Reference Commands

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                 PM2 QUICK REFERENCE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Process Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 start app.js              # Start application
pm2 start app.js --name "api" # Start with name
pm2 stop <name|id|all>        # Stop process
pm2 restart <name|id|all>     # Restart process
pm2 reload <name|id|all>      # Reload (0 downtime)
pm2 delete <name|id|all>      # Delete from PM2

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Information â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 list                      # List all processes
pm2 status                    # Same as list
pm2 show <name|id>            # Process details
pm2 describe <name|id>        # Same as show

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Monitoring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 monit                     # Real-time monitor
pm2 logs                      # Show all logs
pm2 logs <name|id>            # Show specific logs
pm2 logs --lines 100          # Last 100 lines

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cluster â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 start app.js -i max       # Start max instances
pm2 start app.js -i 4         # Start 4 instances
pm2 scale <name> 4            # Scale to 4 instances

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Startup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 startup                   # Generate startup script
pm2 save                      # Save current processes
pm2 resurrect                 # Restore saved processes

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Others â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 flush                     # Clear all logs
pm2 reset <name|id>           # Reset restart count
pm2 update                    # Update PM2 in-memory
pm2 kill                      # Kill PM2 daemon
```

### 4.3 Command Examples with Output

```bash
# Start application
$ pm2 start server.js --name "taskboard-api"

[PM2] Starting /home/user/app/server.js in fork_mode (1 instance)
[PM2] Done.
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name           â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ taskboard-api  â”‚ fork     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 45.2mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# List processes
$ pm2 list

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name           â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ taskboard-api  â”‚ fork     â”‚ 0    â”‚ online    â”‚ 0.3%     â”‚ 52.1mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# Show process details
$ pm2 show taskboard-api

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ status            â”‚ online                                       â”‚
â”‚ name              â”‚ taskboard-api                                â”‚
â”‚ namespace         â”‚ default                                      â”‚
â”‚ version           â”‚ 1.0.0                                        â”‚
â”‚ restarts          â”‚ 0                                            â”‚
â”‚ uptime            â”‚ 2h                                           â”‚
â”‚ script path       â”‚ /home/user/app/server.js                     â”‚
â”‚ script args       â”‚ N/A                                          â”‚
â”‚ error log path    â”‚ /home/user/.pm2/logs/taskboard-api-error.log â”‚
â”‚ out log path      â”‚ /home/user/.pm2/logs/taskboard-api-out.log   â”‚
â”‚ pid               â”‚ 12345                                        â”‚
â”‚ interpreter       â”‚ node                                         â”‚
â”‚ node.js version   â”‚ 20.10.0                                      â”‚
â”‚ created at        â”‚ 2024-01-15T10:00:00.000Z                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ Process

### 5.1 Process States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PM2 Process States                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    start    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚   â”‚stopped â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ online â”‚ â—„â”€â”€â”€ restart                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                       â”‚
â”‚       â–²                       â”‚             â”‚                       â”‚
â”‚       â”‚                       â”‚ crash       â”‚                       â”‚
â”‚       â”‚                       â–¼             â”‚                       â”‚
â”‚       â”‚      stop        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                       â”‚
â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚errored â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚       â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   auto-restart                  â”‚
â”‚       â”‚                                                             â”‚
â”‚       â”‚     delete                                                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [removed from PM2]                        â”‚
â”‚                                                                     â”‚
â”‚   Status Colors:                                                    â”‚
â”‚   ğŸŸ¢ online   - à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´                                            â”‚
â”‚   ğŸ”´ stopped  - à¸«à¸¢à¸¸à¸”à¸—à¸³à¸‡à¸²à¸™                                            â”‚
â”‚   ğŸ”´ errored  - à¸¡à¸µ error (à¸à¸³à¸¥à¸±à¸‡ restart)                              â”‚
â”‚   ğŸŸ¡ launching - à¸à¸³à¸¥à¸±à¸‡ start                                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Start Options

```bash
# Start with specific options
pm2 start server.js \
    --name "taskboard-api" \        # à¸Šà¸·à¹ˆà¸­ process
    --watch \                        # Auto-restart à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™
    --ignore-watch="node_modules" \  # à¹„à¸¡à¹ˆ watch folders à¸™à¸µà¹‰
    --max-memory-restart 200M \      # Restart à¸–à¹‰à¸² memory > 200MB
    --env production \               # Set NODE_ENV
    --log /var/log/app.log \         # Log file path
    --time \                         # Add timestamp to logs
    --cron-restart="0 0 * * *" \     # Restart à¸—à¸¸à¸à¹€à¸—à¸µà¹ˆà¸¢à¸‡à¸„à¸·à¸™
    --no-autorestart                 # à¸›à¸´à¸” auto-restart

# Start with interpreter
pm2 start app.ts --interpreter ts-node
pm2 start app.py --interpreter python3
```

### 5.3 Stop, Restart, Delete

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Stop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 stop taskboard-api          # Stop by name
pm2 stop 0                      # Stop by id
pm2 stop all                    # Stop all

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Restart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 restart taskboard-api       # Restart (has downtime)
pm2 restart all

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Reload (Zero Downtime) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 reload taskboard-api        # Reload gracefully
pm2 reload all

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 delete taskboard-api        # Remove from PM2
pm2 delete all                  # Remove all

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Kill PM2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 kill                        # Stop daemon completely
```

### 5.4 Restart vs Reload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Restart vs Reload                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   pm2 restart (à¸¡à¸µ Downtime)                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚   [Old Process] â”€â”€â”€â”€â”€â–º STOP â”€â”€â”€â”€â”€â–º [New Process] START              â”‚
â”‚        â–¼                                   â–²                        â”‚
â”‚   âŒ Downtime                              â”‚                        â”‚
â”‚      (à¸Šà¹ˆà¸§à¸‡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µ process)                     â”‚                        â”‚
â”‚                                                                     â”‚
â”‚   pm2 reload (Zero Downtime) - Cluster Mode Only                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚   [Process 1] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º            â”‚
â”‚   [Process 2] â”€â”€â”€ STOP â”€â”€â–º [Process 2 New] START â”€â”€â”€â”€â”€â–º             â”‚
â”‚   [Process 3] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º            â”‚
â”‚        â–¼                                                            â”‚
â”‚   âœ… à¹„à¸¡à¹ˆà¸¡à¸µ Downtime (à¸¡à¸µ process à¸­à¸·à¹ˆà¸™à¸£à¸±à¸š request)                          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Ecosystem File

### 6.1 Ecosystem File à¸„à¸·à¸­à¸­à¸°à¹„à¸£?

**Ecosystem File** à¸„à¸·à¸­à¹„à¸Ÿà¸¥à¹Œ configuration à¸ªà¸³à¸«à¸£à¸±à¸š PM2 à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸” settings à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸§à¹‰à¹ƒà¸™à¸—à¸µà¹ˆà¹€à¸”à¸µà¸¢à¸§

### 6.2 à¸ªà¸£à¹‰à¸²à¸‡ Ecosystem File

```bash
# à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œà¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡
pm2 ecosystem

# à¸ˆà¸°à¹„à¸”à¹‰à¹„à¸Ÿà¸¥à¹Œ ecosystem.config.js
```

### 6.3 à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ Ecosystem File

**à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `ecosystem.config.js`:**

```javascript
// ecosystem.config.js
// PM2 Configuration for Task Board Application

module.exports = {
  apps: [
    {
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Basic Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      name: 'taskboard-api',
      script: './server.js',
      cwd: '/home/user/engse207-labs/week6-ntier',
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Instance Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      instances: 1,                    // à¸ˆà¸³à¸™à¸§à¸™ instances (à¸«à¸£à¸·à¸­ 'max')
      exec_mode: 'fork',               // 'fork' à¸«à¸£à¸·à¸­ 'cluster'
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Watch Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      watch: false,                    // Watch for file changes
      ignore_watch: [                  // Folders to ignore
        'node_modules',
        'logs',
        '.git',
        '*.log'
      ],
      watch_delay: 1000,               // Delay before restart (ms)
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Environment Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      env: {
        NODE_ENV: 'development',
        PORT: 3000,
        DB_HOST: 'localhost',
        DB_PORT: 5432,
        DB_NAME: 'taskboard_db',
        DB_USER: 'taskboard',
        DB_PASSWORD: 'taskboard123'
      },
      env_production: {
        NODE_ENV: 'production',
        PORT: 3000
      },
      env_staging: {
        NODE_ENV: 'staging',
        PORT: 3001
      },
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Log Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
      error_file: './logs/error.log',
      out_file: './logs/out.log',
      merge_logs: true,
      log_type: 'json',                // 'json' à¸«à¸£à¸·à¸­ undefined
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Restart Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      autorestart: true,               // Auto restart on crash
      max_restarts: 10,                // Max restarts within min_uptime
      min_uptime: '10s',               // Min uptime before considered stable
      restart_delay: 4000,             // Delay between restarts (ms)
      exp_backoff_restart_delay: 100,  // Exponential backoff
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Memory Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      max_memory_restart: '300M',      // Restart if memory exceeds
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cron Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cron_restart: '0 0 * * *',       // Restart at midnight daily
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Advanced Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      kill_timeout: 5000,              // Time before SIGKILL (ms)
      wait_ready: true,                // Wait for process.send('ready')
      listen_timeout: 8000,            // Time to wait for ready
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Source Map Support â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      source_map_support: true
    }
  ],

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Deploy Configuration (Optional) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  deploy: {
    production: {
      user: 'deploy',
      host: '192.168.1.100',
      ref: 'origin/main',
      repo: 'git@github.com:user/taskboard.git',
      path: '/var/www/taskboard',
      'post-deploy': 'npm install && pm2 reload ecosystem.config.js --env production'
    }
  }
};
```

### 6.4 à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ Ecosystem File

```bash
# Start à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
pm2 start ecosystem.config.js

# Start à¹€à¸‰à¸à¸²à¸°à¸šà¸²à¸‡ app
pm2 start ecosystem.config.js --only taskboard-api

# Start à¸”à¹‰à¸§à¸¢ environment
pm2 start ecosystem.config.js --env production
pm2 start ecosystem.config.js --env staging

# Restart
pm2 restart ecosystem.config.js

# Reload (zero downtime)
pm2 reload ecosystem.config.js

# Stop
pm2 stop ecosystem.config.js

# Delete
pm2 delete ecosystem.config.js
```

### 6.5 Ecosystem File à¹à¸šà¸šà¸‡à¹ˆà¸²à¸¢ (à¸ªà¸³à¸«à¸£à¸±à¸š Lab)

```javascript
// ecosystem.config.js - Simple version for Lab

module.exports = {
  apps: [{
    name: 'taskboard-api',
    script: 'server.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '200M',
    env: {
      NODE_ENV: 'development',
      PORT: 3000,
      DB_HOST: 'localhost',
      DB_PORT: 5432,
      DB_NAME: 'taskboard_db',
      DB_USER: 'taskboard',
      DB_PASSWORD: 'taskboard123'
    }
  }]
};
```

---

## 7. Monitoring à¹à¸¥à¸° Logs

### 7.1 Real-time Monitoring

```bash
# à¹€à¸›à¸´à¸” Dashboard
pm2 monit
```

**PM2 Monit Dashboard:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PM2 Monit                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€ Process List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â— taskboard-api                CPU: 2.3%    MEM: 52.4 MB        â”‚  â”‚
â”‚  â”‚   pid: 12345  restarts: 0      uptime: 2h 15m                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€ Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2024-01-15 10:30:15: Server running on port 3000                â”‚  â”‚
â”‚  â”‚ 2024-01-15 10:30:16: Connected to PostgreSQL                    â”‚  â”‚
â”‚  â”‚ 2024-01-15 10:35:22: GET /api/tasks 200 12ms                    â”‚  â”‚
â”‚  â”‚ 2024-01-15 10:35:45: POST /api/tasks 201 25ms                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€ Metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ App Name: taskboard-api                                         â”‚  â”‚
â”‚  â”‚ Version: 1.0.0                                                  â”‚  â”‚
â”‚  â”‚ Mode: fork                                                      â”‚  â”‚
â”‚  â”‚ Node: v20.10.0                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  [â†‘â†“] Navigate  [Enter] Select  [q] Quit                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Log Management

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ View Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 logs                        # All logs (stream)
pm2 logs taskboard-api          # Specific app logs
pm2 logs --lines 100            # Last 100 lines
pm2 logs --nostream             # Don't stream, just show

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Log Files Location â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ls ~/.pm2/logs/
# taskboard-api-error.log
# taskboard-api-out.log

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Clear Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 flush                       # Clear all logs
pm2 flush taskboard-api         # Clear specific logs

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Rotate Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 install pm2-logrotate       # Install log rotation
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

### 7.3 Log Output Examples

```bash
$ pm2 logs taskboard-api --lines 20

/home/user/.pm2/logs/taskboard-api-out.log last 20 lines:
0|taskboard | 2024-01-15 10:30:15: â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
0|taskboard | 2024-01-15 10:30:15:   ğŸ—ï¸  N-TIER ARCHITECTURE - TASK BOARD API
0|taskboard | 2024-01-15 10:30:15: â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
0|taskboard | 2024-01-15 10:30:15:   ğŸ“¡ Server running on port 3000
0|taskboard | 2024-01-15 10:30:15:   ğŸŒ Environment: development
0|taskboard | 2024-01-15 10:30:16:   âœ… New client connected to PostgreSQL
0|taskboard | 2024-01-15 10:35:22:   ğŸ“Š Query executed: 5ms | Rows: 7
0|taskboard | 2024-01-15 10:35:22:   GET /api/tasks - 200 - 12.345 ms

/home/user/.pm2/logs/taskboard-api-error.log last 20 lines:
(empty if no errors)
```

### 7.4 Process Information

```bash
# à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” process
pm2 show taskboard-api

# Output:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ status            â”‚ online                                       â”‚
â”‚ name              â”‚ taskboard-api                                â”‚
â”‚ namespace         â”‚ default                                      â”‚
â”‚ version           â”‚ 1.0.0                                        â”‚
â”‚ restarts          â”‚ 0                                            â”‚
â”‚ uptime            â”‚ 5h                                           â”‚
â”‚ script path       â”‚ /home/user/app/server.js                     â”‚
â”‚ script args       â”‚ N/A                                          â”‚
â”‚ error log path    â”‚ /home/user/.pm2/logs/taskboard-api-error.log â”‚
â”‚ out log path      â”‚ /home/user/.pm2/logs/taskboard-api-out.log   â”‚
â”‚ pid               â”‚ 12345                                        â”‚
â”‚ interpreter       â”‚ node                                         â”‚
â”‚ interpreter args  â”‚ N/A                                          â”‚
â”‚ script id         â”‚ 0                                            â”‚
â”‚ exec cwd          â”‚ /home/user/app                               â”‚
â”‚ exec mode         â”‚ fork_mode                                    â”‚
â”‚ node.js version   â”‚ 20.10.0                                      â”‚
â”‚ node env          â”‚ development                                  â”‚
â”‚ watch & reload    â”‚ âœ˜                                            â”‚
â”‚ unstable restarts â”‚ 0                                            â”‚
â”‚ created at        â”‚ 2024-01-15T05:30:00.000Z                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Cluster Mode

### 8.1 Cluster Mode à¸„à¸·à¸­à¸­à¸°à¹„à¸£?

**Cluster Mode** à¸„à¸·à¸­à¸à¸²à¸£à¸£à¸±à¸™ Node.js à¸«à¸¥à¸²à¸¢ instances à¹€à¸à¸·à¹ˆà¸­ load balance à¹à¸¥à¸°à¹ƒà¸Šà¹‰ CPU à¸«à¸¥à¸²à¸¢ cores

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Fork Mode vs Cluster Mode                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚   Fork Mode (Default):              Cluster Mode:                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚  Client  â”‚                      â”‚  Client  â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚        â”‚                                 â”‚                        â”‚
â”‚        â–¼                                 â–¼                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚  PM2     â”‚                      â”‚  PM2     â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                      â”‚ (Master) â”‚                  â”‚
â”‚        â”‚                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚        â–¼                                 â”‚ Load Balance           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚  Node.js â”‚                     â–¼           â–¼                  â”‚
â”‚   â”‚ Process  â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ Worker 1 â”‚ â”‚ Worker 2 â”‚            â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚   1 Process                  â”‚ Worker 3 â”‚ â”‚ Worker 4 â”‚            â”‚
â”‚   1 CPU Core                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                   â”‚
â”‚                              4 Processes                          â”‚
â”‚                              4 CPU Cores                          â”‚
â”‚                              Zero Downtime Reload                 â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰ Cluster Mode

```bash
# Start with cluster mode
pm2 start server.js -i max           # à¹ƒà¸Šà¹‰à¸—à¸¸à¸ CPU cores
pm2 start server.js -i 0             # à¹€à¸«à¸¡à¸·à¸­à¸™ max
pm2 start server.js -i 4             # à¹ƒà¸Šà¹‰ 4 instances
pm2 start server.js -i -1            # max - 1 (à¹€à¸«à¸¥à¸·à¸­ 1 core à¸§à¹ˆà¸²à¸‡)

# Scale up/down
pm2 scale taskboard-api 4            # Scale to 4 instances
pm2 scale taskboard-api +2           # Add 2 instances
pm2 scale taskboard-api -1           # Remove 1 instance
```

### 8.3 Cluster Mode à¹ƒà¸™ Ecosystem File

```javascript
// ecosystem.config.js

module.exports = {
  apps: [{
    name: 'taskboard-api',
    script: 'server.js',
    instances: 'max',           // à¸«à¸£à¸·à¸­ 4, 2, -1
    exec_mode: 'cluster',       // à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ 'cluster'
    
    // Cluster specific settings
    instance_var: 'INSTANCE_ID',
    
    // Graceful reload
    listen_timeout: 8000,
    kill_timeout: 5000,
    wait_ready: true
  }]
};
```

### 8.4 Graceful Shutdown (à¸ªà¸³à¸„à¸±à¸à¸ªà¸³à¸«à¸£à¸±à¸š Cluster)

```javascript
// server.js - Graceful shutdown support

const http = require('http');
const app = require('./app');

const server = http.createServer(app);
const PORT = process.env.PORT || 3000;

server.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
    
    // à¸šà¸­à¸ PM2 à¸§à¹ˆà¸²à¸à¸£à¹‰à¸­à¸¡à¹à¸¥à¹‰à¸§
    if (process.send) {
        process.send('ready');
    }
});

// Graceful shutdown
process.on('SIGINT', gracefulShutdown);
process.on('SIGTERM', gracefulShutdown);

function gracefulShutdown(signal) {
    console.log(`Received ${signal}. Shutting down gracefully...`);
    
    server.close(() => {
        console.log('HTTP server closed');
        
        // Close database connections, etc.
        // ...
        
        process.exit(0);
    });
    
    // Force close after 10 seconds
    setTimeout(() => {
        console.error('Forcing shutdown...');
        process.exit(1);
    }, 10000);
}
```

---

## 9. à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š PM2

### 9.1 à¸ªà¸£à¹‰à¸²à¸‡ Test Application

**à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `test-app.js`:**

```javascript
// test-app.js - Simple test application

const http = require('http');

const PORT = process.env.PORT || 3000;
const INSTANCE_ID = process.env.INSTANCE_ID || 0;

const server = http.createServer((req, res) => {
    // Log request
    console.log(`[Instance ${INSTANCE_ID}] ${req.method} ${req.url}`);
    
    // Health check
    if (req.url === '/health') {
        res.writeHead(200, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({
            status: 'healthy',
            instance: INSTANCE_ID,
            pid: process.pid,
            uptime: process.uptime(),
            memory: process.memoryUsage()
        }));
        return;
    }
    
    // Simulate crash (for testing)
    if (req.url === '/crash') {
        console.log('Simulating crash...');
        process.exit(1);
    }
    
    // Simulate memory leak (for testing)
    if (req.url === '/leak') {
        const leak = [];
        for (let i = 0; i < 1000000; i++) {
            leak.push(new Array(1000).fill('x'));
        }
        res.end('Memory increased');
        return;
    }
    
    // Default response
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end(`Hello from instance ${INSTANCE_ID} (PID: ${process.pid})\n`);
});

server.listen(PORT, () => {
    console.log(`[Instance ${INSTANCE_ID}] Server running on port ${PORT}`);
    
    if (process.send) {
        process.send('ready');
    }
});

// Graceful shutdown
process.on('SIGINT', () => {
    console.log('Shutting down...');
    server.close(() => process.exit(0));
});
```

### 9.2 Test Script

**à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `scripts/test-pm2.sh`:**

```bash
#!/bin/bash
# scripts/test-pm2.sh - PM2 Test Script

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸ§ª PM2 Test Suite"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

PASSED=0
FAILED=0

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Helper function
test_result() {
    if [ $1 -eq 0 ]; then
        echo -e "   ${GREEN}âœ“ PASSED${NC}: $2"
        ((PASSED++))
    else
        echo -e "   ${RED}âœ— FAILED${NC}: $2"
        ((FAILED++))
    fi
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 1: PM2 Installation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 1: PM2 Installation"
pm2 --version > /dev/null 2>&1
test_result $? "PM2 is installed"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 2: Start Application
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 2: Start Application"

# Clean up first
pm2 delete test-app 2>/dev/null

# Start
pm2 start test-app.js --name test-app > /dev/null 2>&1
sleep 2

# Check if running
pm2 list | grep -q "test-app.*online"
test_result $? "Application started successfully"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 3: Health Check
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 3: Health Check"
HEALTH=$(curl -s http://localhost:3000/health)
echo "$HEALTH" | grep -q "healthy"
test_result $? "Health endpoint responds"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 4: Auto Restart on Crash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 4: Auto Restart on Crash"

# Get initial restart count
INITIAL_RESTARTS=$(pm2 jlist | jq '.[0].pm2_env.restart_time')

# Trigger crash
curl -s http://localhost:3000/crash > /dev/null 2>&1
sleep 3

# Check if restarted
CURRENT_RESTARTS=$(pm2 jlist | jq '.[0].pm2_env.restart_time')
if [ "$CURRENT_RESTARTS" -gt "$INITIAL_RESTARTS" ]; then
    test_result 0 "Application auto-restarted after crash"
else
    test_result 1 "Application auto-restarted after crash"
fi
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 5: Stop Application
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 5: Stop Application"
pm2 stop test-app > /dev/null 2>&1
sleep 1
pm2 list | grep -q "test-app.*stopped"
test_result $? "Application stopped"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 6: Restart Application
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 6: Restart Application"
pm2 restart test-app > /dev/null 2>&1
sleep 2
pm2 list | grep -q "test-app.*online"
test_result $? "Application restarted"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 7: Logs
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 7: Logs"
LOG_LINES=$(pm2 logs test-app --nostream --lines 5 2>&1)
if [ -n "$LOG_LINES" ]; then
    test_result 0 "Logs are available"
else
    test_result 1 "Logs are available"
fi
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 8: Cluster Mode
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 8: Cluster Mode"

# Start in cluster mode
pm2 delete test-app > /dev/null 2>&1
pm2 start test-app.js --name test-app -i 2 > /dev/null 2>&1
sleep 3

# Check instances
INSTANCES=$(pm2 jlist | jq 'length')
if [ "$INSTANCES" -eq 2 ]; then
    test_result 0 "Cluster mode with 2 instances"
else
    test_result 1 "Cluster mode with 2 instances (got $INSTANCES)"
fi
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Test 9: Load Balancing (Cluster Mode)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Test 9: Load Balancing"

# Make multiple requests
PIDS=""
for i in {1..10}; do
    PID=$(curl -s http://localhost:3000/health | jq -r '.pid')
    PIDS="$PIDS $PID"
done

# Check if different PIDs (load balanced)
UNIQUE_PIDS=$(echo $PIDS | tr ' ' '\n' | sort -u | wc -l)
if [ "$UNIQUE_PIDS" -gt 1 ]; then
    test_result 0 "Requests distributed across instances"
else
    test_result 1 "Requests distributed across instances"
fi
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Cleanup
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "Cleaning up..."
pm2 delete test-app > /dev/null 2>&1
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Summary
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
TOTAL=$((PASSED + FAILED))
echo -e "  Results: ${GREEN}$PASSED passed${NC}, ${RED}$FAILED failed${NC} (Total: $TOTAL)"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
```

### 9.3 Manual Test Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PM2 TEST CHECKLIST                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Basic Operations:                                                 â”‚
â”‚  [ ] pm2 start server.js --name "app"                              â”‚
â”‚  [ ] pm2 list (à¸”à¸¹ status à¹€à¸›à¹‡à¸™ online)                                â”‚
â”‚  [ ] pm2 stop app                                                  â”‚
â”‚  [ ] pm2 restart app                                               â”‚
â”‚  [ ] pm2 delete app                                                â”‚
â”‚                                                                    â”‚
â”‚  Monitoring:                                                       â”‚
â”‚  [ ] pm2 monit (à¸”à¸¹ real-time dashboard)                             â”‚
â”‚  [ ] pm2 logs (à¸”à¸¹ logs)                                             â”‚
â”‚  [ ] pm2 show app (à¸”à¸¹ details)                                      â”‚
â”‚                                                                    â”‚
â”‚  Auto Restart:                                                     â”‚
â”‚  [ ] à¸ªà¸£à¹‰à¸²à¸‡ endpoint à¸—à¸µà¹ˆ crash (process.exit(1))                       â”‚
â”‚  [ ] à¹€à¸£à¸µà¸¢à¸ endpoint â†’ App à¸•à¹‰à¸­à¸‡ restart à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´                        â”‚
â”‚  [ ] pm2 list â†’ restart count à¹€à¸à¸´à¹ˆà¸¡à¸‚à¸¶à¹‰à¸™                                â”‚
â”‚                                                                    â”‚
â”‚  Cluster Mode:                                                     â”‚
â”‚  [ ] pm2 start app.js -i 2                                         â”‚
â”‚  [ ] pm2 list (à¸”à¸¹ 2 instances)                                      â”‚
â”‚  [ ] à¹€à¸£à¸µà¸¢à¸ API à¸«à¸¥à¸²à¸¢à¸„à¸£à¸±à¹‰à¸‡ â†’ PID à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™ (load balanced)                  â”‚
â”‚  [ ] pm2 reload app (zero downtime)                                â”‚
â”‚                                                                    â”‚
â”‚  Startup:                                                          â”‚
â”‚  [ ] pm2 startup (à¸ªà¸£à¹‰à¸²à¸‡ startup script)                             â”‚
â”‚  [ ] pm2 save (à¸šà¸±à¸™à¸—à¸¶à¸ process list)                                  â”‚
â”‚  [ ] reboot à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ â†’ App à¸•à¹‰à¸­à¸‡ start à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´                           â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢

### 10.1 App keeps restarting

```bash
# à¸”à¸¹ logs à¸«à¸²à¸ªà¸²à¹€à¸«à¸•à¸¸
pm2 logs app-name --lines 50

# à¸”à¸¹ restart count à¹à¸¥à¸° status
pm2 show app-name

# à¸ªà¸²à¹€à¸«à¸•à¸¸à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢:
# 1. Port already in use
# 2. Missing dependencies
# 3. Environment variables not set
# 4. Database connection failed

# à¹à¸à¹‰à¹„à¸‚
pm2 delete app-name
pm2 start app.js --name app-name
```

### 10.2 Command not found: pm2

```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š npm global path
npm config get prefix

# à¹€à¸à¸´à¹ˆà¸¡ path à¹ƒà¸™ ~/.bashrc à¸«à¸£à¸·à¸­ ~/.zshrc
export PATH="$PATH:$(npm config get prefix)/bin"

# à¸«à¸£à¸·à¸­à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¹ƒà¸«à¸¡à¹ˆ
sudo npm install -g pm2
```

### 10.3 Permission denied

```bash
# à¸›à¸±à¸à¸«à¸²: pm2 à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¹€à¸‚à¸µà¸¢à¸™ log
# à¹à¸à¹‰à¹„à¸‚: à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² PM2_HOME
export PM2_HOME=/home/user/.pm2

# à¸«à¸£à¸·à¸­ run à¸”à¹‰à¸§à¸¢ sudo (à¹„à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³)
sudo pm2 start app.js
```

### 10.4 Watch not working

```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹€à¸›à¸´à¸” watch
pm2 show app-name | grep watch

# Start à¹ƒà¸«à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡ watch
pm2 delete app-name
pm2 start app.js --name app-name --watch --ignore-watch="node_modules logs"

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š inotify limit (Linux)
cat /proc/sys/fs/inotify/max_user_watches

# à¹€à¸à¸´à¹ˆà¸¡ limit
echo "fs.inotify.max_user_watches=524288" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### 10.5 Memory leak / high memory usage

```bash
# à¸”à¸¹ memory usage
pm2 monit

# à¸•à¸±à¹‰à¸‡ memory limit
pm2 start app.js --max-memory-restart 200M

# Force garbage collection (à¸•à¹‰à¸­à¸‡ start à¸”à¹‰à¸§à¸¢ flag)
pm2 start app.js --node-args="--expose-gc"

# à¹ƒà¸™ code
if (global.gc) {
    global.gc();
}
```

### 10.6 Cluster mode issues

```bash
# à¸›à¸±à¸à¸«à¸²: Reload à¹„à¸¡à¹ˆ work
# à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ cluster mode
pm2 start app.js -i max --name app

# à¸›à¸±à¸à¸«à¸²: Sessions à¹„à¸¡à¹ˆ share à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ instances
# à¹à¸à¹‰à¹„à¸‚: à¹ƒà¸Šà¹‰ external session store (Redis)

# à¸›à¸±à¸à¸«à¸²: Graceful shutdown à¹„à¸¡à¹ˆ work
# à¹à¸à¹‰à¹„à¸‚: à¹€à¸à¸´à¹ˆà¸¡ wait_ready à¹à¸¥à¸° listen_timeout à¹ƒà¸™ config
```

---

## 11. Best Practices

### 11.1 Production Checklist

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#           PM2 PRODUCTION CHECKLIST
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# âœ… 1. à¹ƒà¸Šà¹‰ Ecosystem file
pm2 start ecosystem.config.js --env production

# âœ… 2. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Startup
pm2 startup
pm2 save

# âœ… 3. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Log rotation
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 50M
pm2 set pm2-logrotate:retain 7

# âœ… 4. à¹ƒà¸Šà¹‰ Cluster mode (multi-core)
pm2 start app.js -i max

# âœ… 5. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Memory limit
pm2 start app.js --max-memory-restart 300M

# âœ… 6. Monitor
pm2 monit
# à¸«à¸£à¸·à¸­à¹ƒà¸Šà¹‰ PM2 Plus (cloud monitoring)
```

### 11.2 Ecosystem File Best Practices

```javascript
// ecosystem.config.js - Production Ready

module.exports = {
  apps: [{
    name: 'api',
    script: './dist/server.js',    // à¹ƒà¸Šà¹‰ compiled version
    instances: 'max',              // à¹ƒà¸Šà¹‰à¸—à¸¸à¸ CPU cores
    exec_mode: 'cluster',
    
    // Auto restart
    autorestart: true,
    watch: false,                  // à¸›à¸´à¸” watch à¹ƒà¸™ production
    max_memory_restart: '500M',
    
    // Logging
    log_date_format: 'YYYY-MM-DD HH:mm:ss',
    error_file: '/var/log/api/error.log',
    out_file: '/var/log/api/out.log',
    merge_logs: true,
    
    // Environment
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    
    // Graceful shutdown
    kill_timeout: 5000,
    wait_ready: true,
    listen_timeout: 10000
  }]
};
```

### 11.3 Logging Best Practices

```javascript
// à¹ƒà¸Šà¹‰ structured logging
const log = (level, message, data = {}) => {
    console.log(JSON.stringify({
        timestamp: new Date().toISOString(),
        level,
        message,
        ...data,
        pid: process.pid,
        instance: process.env.INSTANCE_ID
    }));
};

// Usage
log('info', 'Server started', { port: 3000 });
log('error', 'Database error', { error: err.message });
```

### 11.4 Graceful Shutdown Best Practices

```javascript
// à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
const server = app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
    
    // à¸šà¸­à¸ PM2 à¸§à¹ˆà¸² ready
    if (process.send) {
        process.send('ready');
    }
});

// Handle graceful shutdown
const shutdown = async (signal) => {
    console.log(`${signal} received. Graceful shutdown...`);
    
    // 1. à¸«à¸¢à¸¸à¸”à¸£à¸±à¸š connection à¹ƒà¸«à¸¡à¹ˆ
    server.close(async () => {
        console.log('HTTP server closed');
        
        // 2. à¸›à¸´à¸” database connections
        await db.close();
        console.log('Database connections closed');
        
        // 3. Exit
        process.exit(0);
    });
    
    // Force exit à¸«à¸¥à¸±à¸‡ 10 à¸§à¸´à¸™à¸²à¸—à¸µ
    setTimeout(() => {
        console.error('Force shutdown');
        process.exit(1);
    }, 10000);
};

process.on('SIGTERM', () => shutdown('SIGTERM'));
process.on('SIGINT', () => shutdown('SIGINT'));
```

---

## ğŸ“š Quick Reference Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PM2 QUICK REFERENCE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  ğŸš€ START:                                                         â”‚
â”‚  pm2 start app.js                   # Basic start                  â”‚
â”‚  pm2 start app.js --name "api"      # With name                    â”‚
â”‚  pm2 start app.js -i max            # Cluster mode                 â”‚
â”‚  pm2 start ecosystem.config.js      # Use config file              â”‚
â”‚                                                                    â”‚
â”‚  â¹ï¸ STOP/RESTART:                                                  â”‚
â”‚  pm2 stop <name|id|all>             # Stop                         â”‚
â”‚  pm2 restart <name|id|all>          # Restart                      â”‚
â”‚  pm2 reload <name|id|all>           # Zero downtime reload         â”‚
â”‚  pm2 delete <name|id|all>           # Remove from PM2              â”‚
â”‚                                                                    â”‚
â”‚  ğŸ“Š MONITORING:                                                    â”‚
â”‚  pm2 list                           # List all processes           â”‚
â”‚  pm2 show <name>                    # Process details              â”‚
â”‚  pm2 monit                          # Real-time dashboard          â”‚
â”‚  pm2 logs                           # View logs                    â”‚
â”‚                                                                    â”‚
â”‚  ğŸ“ˆ SCALING:                                                       â”‚
â”‚  pm2 scale <name> 4                 # Scale to 4 instances         â”‚
â”‚  pm2 scale <name> +2                # Add 2 instances              â”‚
â”‚                                                                    â”‚
â”‚  ğŸ”„ STARTUP:                                                       â”‚
â”‚  pm2 startup                        # Generate startup script      â”‚
â”‚  pm2 save                           # Save process list            â”‚
â”‚  pm2 resurrect                      # Restore saved processes      â”‚
â”‚                                                                    â”‚
â”‚  ğŸ§¹ MAINTENANCE:                                                   â”‚
â”‚  pm2 flush                          # Clear all logs               â”‚
â”‚  pm2 reset <name>                   # Reset restart count          â”‚
â”‚  pm2 update                         # Update PM2 daemon            â”‚
â”‚                                                                    â”‚
â”‚  ğŸ“ LOG PATHS:                                                     â”‚
â”‚  ~/.pm2/logs/<name>-out.log         # Standard output              â”‚
â”‚  ~/.pm2/logs/<name>-error.log       # Error output                 â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*ENGCE301 - Software Design and Development*  
*à¹€à¸­à¸à¸ªà¸²à¸£à¸›à¸£à¸°à¸à¸­à¸š: PM2 Process Manager*
